

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.14. The query() Method (Experimental) &mdash; Pandas Doc</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Pandas Doc" href="../index.html"/>
        <link rel="up" title="7. Indexing and Selecting Data" href="indexing.html"/>
        <link rel="next" title="7.15. Duplicate Data" href="indexing15.html"/>
        <link rel="prev" title="7.13. The where() Method and Masking" href="indexing13.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Pandas Doc
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../10min/10min.html">1. 10 Minutes to pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min1.html">1.1. Object Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min2.html">1.2. Viewing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min3.html">1.3. Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min3.html#getting">1.3.1. Getting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min3.html#selection-by-label">1.3.2. Selection by Label</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min3.html#selection-by-position">1.3.3. Selection by Position</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min3.html#boolean-indexing">1.3.4. Boolean Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min3.html#setting">1.3.5. Setting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min4.html">1.4. Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min5.html">1.5. Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min5.html#stats">1.5.1. Stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min5.html#apply">1.5.2. Apply</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min5.html#histogramming">1.5.3. Histogramming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min5.html#string-methods">1.5.4. String Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min6.html">1.6. Merge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min6.html#concat">1.6.1. Concat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min6.html#join">1.6.2. Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min6.html#append">1.6.3. Append</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min7.html">1.7. Grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min8.html">1.8. Reshaping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min8.html#stack">1.8.1. Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min8.html#pivot-tables">1.8.2. Pivot Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min9.html">1.9. Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min10.html">1.10. Categoricals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min11.html">1.11. Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min12.html">1.12. Getting Data In/Out</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min12.html#csv">1.12.1. CSV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min12.html#hdf5">1.12.2. HDF5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10min/10min12.html#excel">1.12.3. Excel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10min/10min13.html">1.13. Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/cookbook.html">2. Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook1.html">2.1. Idioms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook1.html#if-then">2.1.1. if-then...</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook1.html#splitting">2.1.2. Splitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook1.html#building-criteria">2.1.3. Building Criteria</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook2.html">2.2. Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook2.html#dataframes">2.2.1. DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook2.html#panels">2.2.2. Panels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook2.html#new-columns">2.2.3. New Columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook3.html">2.3. MultiIndexing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook3.html#arithmetic">2.3.1. Arithmetic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook3.html#slicing">2.3.2. Slicing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook3.html#sorting">2.3.3. Sorting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook3.html#levels">2.3.4. Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook3.html#panelnd">2.3.5. panelnd</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook4.html">2.4. Missing Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook4.html#replace">2.4.1. Replace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook5.html">2.5. Grouping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook5.html#expanding-data">2.5.1. Expanding Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook5.html#splitting">2.5.2. Splitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook5.html#pivot">2.5.3. Pivot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook5.html#apply">2.5.4. Apply</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook6.html">2.6. Timeseries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook6.html#resampling">2.6.1. Resampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook7.html">2.7. Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook8.html">2.8. Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook9.html">2.9. Data In/Out</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#csv">2.9.1. CSV</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cookbook/cookbook9.html#skip-row-between-header-and-data">2.9.1.1. Skip row between header and data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#sql">2.9.2. SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#excel">2.9.3. Excel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#html">2.9.4. HTML</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#hdfstore">2.9.5. HDFStore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/cookbook9.html#binary-files">2.9.6. Binary Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook10.html">2.10. Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook11.html">2.11. Timedeltas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook12.html">2.12. Aliasing Axis Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/cookbook13.html">2.13. Creating Example Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dsintro/dsintro.html">3. Intro to Data Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dsintro/dsintro1.html">3.1. Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro1.html#series-is-ndarray-like">3.1.1. Series is ndarray-like</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro1.html#series-is-dict-like">3.1.2. Series is dict-like</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro1.html#vectorized-operations-and-label-alignment-with-series">3.1.3. Vectorized operations and label alignment with Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro1.html#name-attribute">3.1.4. Name attribute</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dsintro/dsintro2.html">3.2. DataFrame</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-dict-of-series-or-dicts">3.2.1. From dict of Series or dicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-dict-of-ndarrays-lists">3.2.2. From dict of ndarrays / lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-structured-or-record-array">3.2.3. From structured or record array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-a-list-of-dicts">3.2.4. From a list of dicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-a-dict-of-tuples">3.2.5. From a dict of tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#from-a-series">3.2.6. From a Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#alternate-constructors">3.2.7. Alternate Constructors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#column-selection-addition-deletion">3.2.8. Column selection, addition, deletion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#assigning-new-columns-in-method-chains">3.2.9. Assigning New Columns in Method Chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#indexing-selection">3.2.10. Indexing / Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#data-alignment-and-arithmetic">3.2.11. Data alignment and arithmetic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#transposing">3.2.12. Transposing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#dataframe-interoperability-with-numpy-functions">3.2.13. DataFrame interoperability with NumPy functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#console-display">3.2.14. Console display</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro2.html#dataframe-column-attribute-access-and-ipython-completion">3.2.15. DataFrame column attribute access and IPython completion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dsintro/dsintro3.html">3.3. Panel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#from-3d-ndarray-with-optional-axis-labels">3.3.1. From 3D ndarray with optional axis labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#from-dict-of-dataframe-objects">3.3.2. From dict of DataFrame objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#from-dataframe-using-to-panel-method">3.3.3. From DataFrame using <code class="docutils literal"><span class="pre">to_panel</span></code> method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#item-selection-addition-deletion">3.3.4. Item selection / addition / deletion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#transposing">3.3.5. Transposing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#indexing-selection">3.3.6. Indexing / Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#squeezing">3.3.7. Squeezing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro3.html#conversion-to-dataframe">3.3.8. Conversion to DataFrame</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dsintro/dsintro4.html">3.4. Panel4D (Experimental)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro4.html#from-4d-ndarray-with-optional-axis-labels">3.4.1. From 4D ndarray with optional axis labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro4.html#from-dict-of-panel-objects">3.4.2. From dict of Panel objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro4.html#slicing">3.4.3. Slicing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsintro/dsintro4.html#transposing">3.4.4. Transposing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dsintro/dsintro5.html">3.5. PanelND (Experimental)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/basics.html">4. Essential Basic Functionality</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics1.html">4.1. Head and Tail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics2.html">4.2. Attributes and the raw ndarray(s)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics3.html">4.3. Accelerated operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics4.html">4.4. Flexible binary operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#matching-broadcasting-behavior">4.4.1. Matching / broadcasting behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#missing-data-operations-with-fill-values">4.4.2. Missing data / operations with fill values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#flexible-comparisons">4.4.3. Flexible Comparisons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#boolean-reductions">4.4.4. Boolean Reductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#comparing-if-objects-are-equivalent">4.4.5. Comparing if objects are equivalent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#comparing-array-like-objects">4.4.6. Comparing array-like objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#combining-overlapping-data-sets">4.4.7. Combining overlapping data sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics4.html#general-dataframe-combine">4.4.8. General DataFrame Combine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics5.html">4.5. Descriptive statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics5.html#summarizing-data-describe">4.5.1. Summarizing data: describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics5.html#index-of-min-max-values">4.5.2. Index of Min/Max Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics5.html#value-counts-histogramming-mode">4.5.3. Value counts (histogramming) / Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics5.html#discretization-and-quantiling">4.5.4. Discretization and quantiling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics6.html">4.6. Function application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics6.html#tablewise-function-application">4.6.1. Tablewise Function Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics6.html#row-or-column-wise-function-application">4.6.2. Row or Column-wise Function Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics6.html#applying-elementwise-python-functions">4.6.3. Applying elementwise Python functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics6.html#applying-with-a-panel">4.6.4. Applying with a Panel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics7.html">4.7. Reindexing and altering labels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#reindexing-to-align-with-another-object">4.7.1. Reindexing to align with another object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#aligning-objects-with-each-other-with-align">4.7.2. Aligning objects with each other with <code class="docutils literal"><span class="pre">align</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#filling-while-reindexing">4.7.3. Filling while reindexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#limits-on-filling-while-reindexing">4.7.4. Limits on filling while reindexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#dropping-labels-from-an-axis">4.7.5. Dropping labels from an axis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics7.html#renaming-mapping-labels">4.7.6. Renaming / mapping labels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics8.html">4.8. Iteration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics8.html#iteritems">4.8.1. iteritems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics8.html#iterrows">4.8.2. iterrows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics8.html#itertuples">4.8.3. itertuples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics9.html">4.9. .dt accessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics10.html">4.10. Vectorized string methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics11.html">4.11. Sorting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics11.html#by-index">4.11.1. By Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics11.html#by-values">4.11.2. By Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics11.html#searchsorted">4.11.3. searchsorted</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics11.html#smallest-largest-values">4.11.4. smallest / largest values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics11.html#sorting-by-a-multi-index-column">4.11.5. Sorting by a multi-index column</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics12.html">4.12. Copying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics13.html">4.13. dtypes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics13.html#defaults">4.13.1. defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics13.html#upcasting">4.13.2. upcasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics13.html#astype">4.13.3. astype</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics13.html#object-conversion">4.13.4. object conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/basics13.html#gotchas">4.13.5. gotchas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics14.html">4.14. Selecting columns based on <code class="docutils literal"><span class="pre">dtype</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../text/text.html">5. Working with Text Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../text/text1.html">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/text2.html">5.2. Splitting and Replacing Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/text3.html">5.3. Indexing with <code class="docutils literal"><span class="pre">.str</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/text4.html">5.4. Extracting Substrings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../text/text4.html#extract-first-match-in-each-subject-extract">5.4.1. Extract first match in each subject (extract)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../text/text4.html#extract-all-matches-in-each-subject-extractall">5.4.2. Extract all matches in each subject (extractall)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../text/text5.html">5.5. Testing for Strings that Match or Contain a Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/text6.html">5.6. Creating Indicator Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/text7.html">5.7. Method Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../options/options.html">6. Options and Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../options/options1.html">6.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options2.html">6.2. Getting and Setting Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options3.html">6.3. Setting Startup Options in python/ipython Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options4.html">6.4. Frequently Used Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options5.html">6.5. Available Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options6.html">6.6. Number Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../options/options7.html">6.7. Unicode Formatting</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="indexing.html">7. Indexing and Selecting Data</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="indexing1.html">7.1. Different Choices for Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing2.html">7.2. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing3.html">7.3. Attribute Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing4.html">7.4. Slicing ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing5.html">7.5. Selection By Label</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing6.html">7.6. Selection By Position</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing7.html">7.7. Selection By Callable</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing8.html">7.8. Selecting Random Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing9.html">7.9. Setting With Enlargement</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing10.html">7.10. Fast scalar value getting and setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing11.html">7.11. Boolean indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing12.html">7.12. Indexing with isin</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing13.html">7.13. The <code class="docutils literal"><span class="pre">where()</span></code> Method and Masking</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">7.14. The <code class="docutils literal"><span class="pre">query()</span></code> Method (Experimental)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multiindex-query-syntax">7.14.1. <code class="docutils literal"><span class="pre">MultiIndex</span></code> <code class="docutils literal"><span class="pre">query()</span></code> Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#query-use-cases">7.14.2. <code class="docutils literal"><span class="pre">query()</span></code> Use Cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#query-python-versus-pandas-syntax-comparison">7.14.3. <code class="docutils literal"><span class="pre">query()</span></code> Python versus pandas Syntax Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-in-and-not-in-operators">7.14.4. The <code class="docutils literal"><span class="pre">in</span></code> and <code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code> operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#special-use-of-the-operator-with-list-objects">7.14.5. Special use of the <code class="docutils literal"><span class="pre">==</span></code> operator with <code class="docutils literal"><span class="pre">list</span></code> objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boolean-operators">7.14.6. Boolean Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-of-query">7.14.7. Performance of <code class="docutils literal"><span class="pre">query()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="indexing15.html">7.15. Duplicate Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing16.html">7.16. Dictionary-like <code class="docutils literal"><span class="pre">get()</span></code> method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing17.html">7.17. The <code class="docutils literal"><span class="pre">select()</span></code> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing18.html">7.18. The <code class="docutils literal"><span class="pre">lookup()</span></code> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing19.html">7.19. Index objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="indexing19.html#setting-metadata">7.19.1. Setting metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="indexing19.html#set-operations-on-index-objects">7.19.2. Set operations on Index objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="indexing19.html#missing-values">7.19.3. Missing values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="indexing20.html">7.20. Set / Reset Index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="indexing20.html#set-an-index">7.20.1. Set an index</a></li>
<li class="toctree-l3"><a class="reference internal" href="indexing20.html#reset-the-index">7.20.2. Reset the index</a></li>
<li class="toctree-l3"><a class="reference internal" href="indexing20.html#adding-an-ad-hoc-index">7.20.3. Adding an ad hoc index</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="indexing21.html">7.21. Returning a view versus a copy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="indexing21.html#why-does-assignment-fail-when-using-chained-indexing">7.21.1. Why does assignment fail when using chained indexing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="indexing21.html#evaluation-order-matters">7.21.2. Evaluation order matters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/advanced.html">8. MultiIndex / Advanced Indexing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced1.html">8.1. Hierarchical indexing (MultiIndex)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced1.html#creating-a-multiindex-hierarchical-index-object">8.1.1. Creating a MultiIndex (hierarchical index) object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced1.html#reconstructing-the-level-labels">8.1.2. Reconstructing the level labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced1.html#basic-indexing-on-axis-with-multiindex">8.1.3. Basic indexing on axis with MultiIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced1.html#data-alignment-and-using-reindex">8.1.4. Data alignment and using <code class="docutils literal"><span class="pre">reindex</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced2.html">8.2. Advanced indexing with hierarchical index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced2.html#using-slicers">8.2.1. Using slicers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced2.html#cross-section">8.2.2. Cross-section</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced2.html#advanced-reindexing-and-alignment">8.2.3. Advanced reindexing and alignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced2.html#swapping-levels-with-swaplevel">8.2.4. Swapping levels with <code class="docutils literal"><span class="pre">swaplevel()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced2.html#reordering-levels-with-reorder-levels">8.2.5. Reordering levels with <code class="docutils literal"><span class="pre">reorder_levels()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced3.html">8.3. Sorting a <code class="docutils literal"><span class="pre">MultiIndex</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced4.html">8.4. Take Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced5.html">8.5. Index Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced5.html#categoricalindex">8.5.1. CategoricalIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced5.html#int64index-and-rangeindex">8.5.2. Int64Index and RangeIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced5.html#float64index">8.5.3. Float64Index</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../missing/missing.html">9. Working with missing data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing1.html">9.1. Missing data basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing1.html#when-why-does-data-become-missing">9.1.1. When / why does data become missing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing1.html#values-considered-missing">9.1.2. Values considered &#8220;missing&#8221;</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing2.html">9.2. Datetimes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing3.html">9.3. Inserting missing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing4.html">9.4. Calculations with missing data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing4.html#na-values-in-groupby">9.4.1. NA values in GroupBy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing5.html">9.5. Cleaning / filling missing data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#filling-missing-values-fillna">9.5.1. Filling missing values: fillna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#filling-with-a-pandasobject">9.5.2. Filling with a PandasObject</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#dropping-axis-labels-with-missing-data-dropna">9.5.3. Dropping axis labels with missing data: dropna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#interpolation">9.5.4. Interpolation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../missing/missing5.html#interpolation-limits">9.5.4.1. Interpolation Limits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#replacing-generic-values">9.5.5. Replacing Generic Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#string-regular-expression-replacement">9.5.6. String/Regular Expression Replacement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../missing/missing5.html#numeric-replacement">9.5.7. Numeric Replacement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../missing/missing6.html">9.6. Missing data casting rules and indexing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../groupby/groupby.html">10. Group By: split-apply-combine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby1.html">10.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby2.html">10.2. Splitting an object into groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby2.html#groupby-sorting">10.2.1. GroupBy sorting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby2.html#groupby-object-attributes">10.2.2. GroupBy object attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby2.html#groupby-with-multiindex">10.2.3. GroupBy with MultiIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby2.html#dataframe-column-selection-in-groupby">10.2.4. DataFrame column selection in GroupBy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby3.html">10.3. Iterating through groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby3.html#selecting-a-group">10.4. Selecting a group</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby4.html">10.5. Aggregation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby4.html#applying-multiple-functions-at-once">10.5.1. Applying multiple functions at once</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby4.html#applying-different-functions-to-dataframe-columns">10.5.2. Applying different functions to DataFrame columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby4.html#cython-optimized-aggregation-functions">10.5.3. Cython-optimized aggregation functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby5.html">10.6. Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby6.html">10.7. Filtration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby7.html">10.8. Dispatching to instance methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby8.html">10.9. Flexible <code class="docutils literal"><span class="pre">apply</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby9.html">10.10. Other useful features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#automatic-exclusion-of-nuisance-columns">10.10.1. Automatic exclusion of &#8220;nuisance&#8221; columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#na-and-nat-group-handling">10.10.2. NA and NaT group handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#grouping-with-ordered-factors">10.10.3. Grouping with ordered factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#grouping-with-a-grouper-specification">10.10.4. Grouping with a Grouper specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#taking-the-first-rows-of-each-group">10.10.5. Taking the first rows of each group</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#taking-the-nth-row-of-each-group">10.10.6. Taking the nth row of each group</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#enumerate-group-items">10.10.7. Enumerate group items</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby9.html#plotting">10.10.8. Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../groupby/groupby10.html">10.11. Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby10.html#regrouping-by-factor">10.11.1. Regrouping by factor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby10.html#groupby-by-indexer-to-resample-data">10.11.2. Groupby by Indexer to &#8216;resample&#8217; data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../groupby/groupby10.html#returning-a-series-to-propagate-names">10.11.3. Returning a Series to propagate names</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../merging/merging.html">11. Merge, join, and concatenate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../merging/merging1.html">11.1. Concatenating objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#set-logic-on-the-other-axes">11.1.1. Set logic on the other axes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#concatenating-using-append">11.1.2. Concatenating using <code class="docutils literal"><span class="pre">append</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#ignoring-indexes-on-the-concatenation-axis">11.1.3. Ignoring indexes on the concatenation axis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#concatenating-with-mixed-ndims">11.1.4. Concatenating with mixed ndims</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#more-concatenating-with-group-keys">11.1.5. More concatenating with group keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging1.html#appending-rows-to-a-dataframe">11.1.6. Appending rows to a DataFrame</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../merging/merging2.html">11.2. Database-style DataFrame joining/merging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#brief-primer-on-merge-methods-relational-algebra">11.2.1. Brief primer on merge methods (relational algebra)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#the-merge-indicator">11.2.2. The merge indicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#joining-on-index">11.2.3. Joining on index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#joining-key-columns-on-an-index">11.2.4. Joining key columns on an index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#joining-a-single-index-to-a-multi-index">11.2.5. Joining a single Index to a Multi-index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#joining-with-two-multi-indexes">11.2.6. Joining with two multi-indexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#overlapping-value-columns">11.2.7. Overlapping value columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#joining-multiple-dataframe-or-panel-objects">11.2.8. Joining multiple DataFrame or Panel objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging2.html#merging-together-values-within-series-or-dataframe-columns">11.2.9. Merging together values within Series or DataFrame columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../merging/merging3.html">11.3. Timeseries friendly merging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging3.html#merging-ordered-data">11.3.1. Merging Ordered Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../merging/merging3.html#merging-asof">11.3.2. Merging AsOf</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pandas Doc</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="indexing.html">7. Indexing and Selecting Data</a> &raquo;</li>
        
      <li>7.14. The <code class="docutils literal"><span class="pre">query()</span></code> Method (Experimental)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/indexing/indexing14.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="the-query-method-experimental">
<span id="indexing-query"></span><h1>7.14. The <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> Method (Experimental)<a class="headerlink" href="#the-query-method-experimental" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.13.</span></p>
</div>
<p><code class="xref py py-class docutils literal"><span class="pre">DataFrame</span></code> objects have a <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code>
method that allows selection using an expression.</p>
<p>You can get the value of the frame where column <code class="docutils literal"><span class="pre">b</span></code> has values
between the values of columns <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">c</span></code>. For example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>

<span class="gp">In [3]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>

<span class="gp">In [4]: </span><span class="n">df</span>
<span class="gh">Out[4]: </span><span class="go"></span>
<span class="go">         a       b       c</span>
<span class="go">0   0.2370  0.0076  0.0198</span>
<span class="go">1   0.3131  0.0995  0.1952</span>
<span class="go">2   0.2073  0.1649  0.7119</span>
<span class="go">3   0.0321  0.1974  0.9646</span>
<span class="go">..     ...     ...     ...</span>
<span class="go">6   0.8615  0.3707  0.3688</span>
<span class="go">7   0.5429  0.6828  0.8229</span>
<span class="go">8   0.1314  0.0776  0.8409</span>
<span class="go">9   0.2210  0.7529  0.3430</span>

<span class="go">[10 rows x 3 columns]</span>

<span class="go"># pure python</span>
<span class="gp">In [5]: </span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="p">)]</span>
<span class="gh">Out[5]: </span><span class="go"></span>
<span class="go">        a       b       c</span>
<span class="go">3  0.0321  0.1974  0.9646</span>
<span class="go">4  0.5739  0.6992  0.9746</span>
<span class="go">7  0.5429  0.6828  0.8229</span>

<span class="go"># query</span>
<span class="gp">In [6]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(a &lt; b) &amp; (b &lt; c)&#39;</span><span class="p">)</span>
<span class="gh">Out[6]: </span><span class="go"></span>
<span class="go">        a       b       c</span>
<span class="go">3  0.0321  0.1974  0.9646</span>
<span class="go">4  0.5739  0.6992  0.9746</span>
<span class="go">7  0.5429  0.6828  0.8229</span>
</pre></div>
</div>
<p>Do the same thing but fall back on a named index if there is no column
with the name <code class="docutils literal"><span class="pre">a</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">))</span>

<span class="gp">In [8]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>

<span class="gp">In [9]: </span><span class="n">df</span>
<span class="gh">Out[9]: </span><span class="go"></span>
<span class="go">    b  c</span>
<span class="go">a       </span>
<span class="go">0   4  2</span>
<span class="go">1   3  2</span>
<span class="go">2   2  0</span>
<span class="go">3   1  3</span>
<span class="go">.. .. ..</span>
<span class="go">6   4  3</span>
<span class="go">7   3  0</span>
<span class="go">8   2  3</span>
<span class="go">9   2  4</span>

<span class="go">[10 rows x 2 columns]</span>

<span class="gp">In [10]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b and b &lt; c&#39;</span><span class="p">)</span>
<span class="gh">Out[10]: </span><span class="go"></span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [b, c]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
<p>If instead you don&#8217;t want to or cannot name your index, you can use the name
<code class="docutils literal"><span class="pre">index</span></code> in your query expression:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">))</span>

<span class="gp">In [12]: </span><span class="n">df</span>
<span class="gh">Out[12]: </span><span class="go"></span>
<span class="go">    b  c</span>
<span class="go">0   1  8</span>
<span class="go">1   3  3</span>
<span class="go">2   5  1</span>
<span class="go">3   9  2</span>
<span class="go">.. .. ..</span>
<span class="go">6   6  9</span>
<span class="go">7   2  1</span>
<span class="go">8   1  0</span>
<span class="go">9   0  8</span>

<span class="go">[10 rows x 2 columns]</span>

<span class="gp">In [13]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index &lt; b &lt; c&#39;</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go"></span>
<span class="go">   b  c</span>
<span class="go">0  1  8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the name of your index overlaps with a column name, the column name is
given precedence. For example,</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)})</span>

<span class="gp">In [15]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>

<span class="gp">In [16]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &gt; 2&#39;</span><span class="p">)</span> <span class="c1"># uses the column &#39;a&#39;, not the index</span>
<span class="gh">Out[16]: </span><span class="go"></span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [a]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
<p>You can still use the index in a query expression by using the special
identifier &#8216;index&#8217;:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index &gt; 2&#39;</span><span class="p">)</span>
<span class="gh">Out[17]: </span><span class="go"></span>
<span class="go">   a</span>
<span class="go">a   </span>
<span class="go">3  0</span>
<span class="go">4  2</span>
</pre></div>
</div>
<p class="last">If for some reason you have a column named <code class="docutils literal"><span class="pre">index</span></code>, then you can refer to
the index as <code class="docutils literal"><span class="pre">ilevel_0</span></code> as well, but at this point you should consider
renaming your columns to something less ambiguous.</p>
</div>
<div class="section" id="multiindex-query-syntax">
<h2>7.14.1. <code class="xref py py-class docutils literal"><span class="pre">MultiIndex</span></code> <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> Syntax<a class="headerlink" href="#multiindex-query-syntax" title="Permalink to this headline">¶</a></h2>
<p>You can also use the levels of a <code class="docutils literal"><span class="pre">DataFrame</span></code> with a
<code class="xref py py-class docutils literal"><span class="pre">MultiIndex</span></code> as if they were columns in the frame:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>

<span class="gp">In [19]: </span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">foods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;ham&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="gp">In [21]: </span><span class="n">colors</span>
<span class="gh">Out[21]: </span><span class="go"></span>
<span class="go">array([&#39;green&#39;, &#39;red&#39;, &#39;red&#39;, &#39;green&#39;, &#39;red&#39;, &#39;green&#39;, &#39;green&#39;, &#39;red&#39;,</span>
<span class="go">       &#39;green&#39;, &#39;red&#39;], </span>
<span class="go">      dtype=&#39;|S5&#39;)</span>

<span class="gp">In [22]: </span><span class="n">foods</span>
<span class="gh">Out[22]: </span><span class="go"></span>
<span class="go">array([&#39;eggs&#39;, &#39;eggs&#39;, &#39;eggs&#39;, &#39;eggs&#39;, &#39;eggs&#39;, &#39;ham&#39;, &#39;eggs&#39;, &#39;eggs&#39;,</span>
<span class="go">       &#39;eggs&#39;, &#39;eggs&#39;], </span>
<span class="go">      dtype=&#39;|S4&#39;)</span>

<span class="gp">In [23]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span><span class="n">colors</span><span class="p">,</span> <span class="n">foods</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;food&#39;</span><span class="p">])</span>

<span class="gp">In [24]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="n">df</span>
<span class="gh">Out[25]: </span><span class="go"></span>
<span class="go">                 0       1</span>
<span class="go">color food                </span>
<span class="go">green eggs  0.2513 -0.1437</span>
<span class="go">red   eggs  0.1958 -0.8763</span>
<span class="go">      eggs -0.7964  0.2935</span>
<span class="go">green eggs -0.5310  1.5091</span>
<span class="go">...            ...     ...</span>
<span class="go">      eggs  0.0068 -0.8226</span>
<span class="go">red   eggs  0.3901  0.6442</span>
<span class="go">green eggs -0.7360 -1.0821</span>
<span class="go">red   eggs -0.4404  0.0792</span>

<span class="go">[10 rows x 2 columns]</span>

<span class="gp">In [26]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;color == &quot;red&quot;&#39;</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go"></span>
<span class="go">                 0       1</span>
<span class="go">color food                </span>
<span class="go">red   eggs  0.1958 -0.8763</span>
<span class="go">      eggs -0.7964  0.2935</span>
<span class="go">      eggs  0.5069  0.5864</span>
<span class="go">      eggs  0.3901  0.6442</span>
<span class="go">      eggs -0.4404  0.0792</span>
</pre></div>
</div>
<p>If the levels of the <code class="docutils literal"><span class="pre">MultiIndex</span></code> are unnamed, you can refer to them using
special names:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

<span class="gp">In [28]: </span><span class="n">df</span>
<span class="gh">Out[28]: </span><span class="go"></span>
<span class="go">                 0       1</span>
<span class="go">green eggs  0.2513 -0.1437</span>
<span class="go">red   eggs  0.1958 -0.8763</span>
<span class="go">      eggs -0.7964  0.2935</span>
<span class="go">green eggs -0.5310  1.5091</span>
<span class="go">...            ...     ...</span>
<span class="go">      eggs  0.0068 -0.8226</span>
<span class="go">red   eggs  0.3901  0.6442</span>
<span class="go">green eggs -0.7360 -1.0821</span>
<span class="go">red   eggs -0.4404  0.0792</span>

<span class="go">[10 rows x 2 columns]</span>

<span class="gp">In [29]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ilevel_0 == &quot;red&quot;&#39;</span><span class="p">)</span>
<span class="gh">Out[29]: </span><span class="go"></span>
<span class="go">               0       1</span>
<span class="go">red eggs  0.1958 -0.8763</span>
<span class="go">    eggs -0.7964  0.2935</span>
<span class="go">    eggs  0.5069  0.5864</span>
<span class="go">    eggs  0.3901  0.6442</span>
<span class="go">    eggs -0.4404  0.0792</span>
</pre></div>
</div>
<p>The convention is <code class="docutils literal"><span class="pre">ilevel_0</span></code>, which means &#8220;index level 0&#8221; for the 0th level
of the <code class="docutils literal"><span class="pre">index</span></code>.</p>
</div>
<div class="section" id="query-use-cases">
<h2>7.14.2. <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> Use Cases<a class="headerlink" href="#query-use-cases" title="Permalink to this headline">¶</a></h2>
<p>A use case for <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> is when you have a collection of
<code class="xref py py-class docutils literal"><span class="pre">DataFrame</span></code> objects that have a subset of column names (or index
levels/names) in common. You can pass the same query to both frames <em>without</em>
having to specify which frame you&#8217;re interested in querying</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>

<span class="gp">In [31]: </span><span class="n">df</span>
<span class="gh">Out[31]: </span><span class="go"></span>
<span class="go">         a       b       c</span>
<span class="go">0   0.1427  0.8672  0.1419</span>
<span class="go">1   0.7378  0.7852  0.5929</span>
<span class="go">2   0.1730  0.9451  0.1403</span>
<span class="go">3   0.4987  0.0624  0.7161</span>
<span class="go">..     ...     ...     ...</span>
<span class="go">6   0.0155  0.7807  0.5830</span>
<span class="go">7   0.8813  0.4309  0.6147</span>
<span class="go">8   0.6297  0.2569  0.3005</span>
<span class="go">9   0.8960  0.7063  0.2833</span>

<span class="go">[10 rows x 3 columns]</span>

<span class="gp">In [32]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="gp">In [33]: </span><span class="n">df2</span>
<span class="gh">Out[33]: </span><span class="go"></span>
<span class="go">         a       b       c</span>
<span class="go">0   0.4871  0.6371  0.5722</span>
<span class="go">1   0.8823  0.8011  0.8852</span>
<span class="go">2   0.9926  0.1276  0.0486</span>
<span class="go">3   0.0866  0.5796  0.2961</span>
<span class="go">..     ...     ...     ...</span>
<span class="go">8   0.3562  0.7629  0.8319</span>
<span class="go">9   0.4292  0.4811  0.6428</span>
<span class="go">10  0.6572  0.5602  0.7924</span>
<span class="go">11  0.1042  0.1500  0.3098</span>

<span class="go">[12 rows x 3 columns]</span>

<span class="gp">In [34]: </span><span class="n">expr</span> <span class="o">=</span> <span class="s1">&#39;0.0 &lt;= a &lt;= c &lt;= 0.5&#39;</span>

<span class="gp">In [35]: </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">frame</span><span class="p">:</span> <span class="n">frame</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="p">[</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
<span class="gh">Out[35]: </span><span class="go"></span>
<span class="go">[Empty DataFrame</span>
<span class="go"> Columns: [a, b, c]</span>
<span class="go"> Index: [],          a       b       c</span>
<span class="go"> 3   0.0866  0.5796  0.2961</span>
<span class="go"> 11  0.1042  0.1500  0.3098]</span>
</pre></div>
</div>
</div>
<div class="section" id="query-python-versus-pandas-syntax-comparison">
<h2>7.14.3. <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> Python versus pandas Syntax Comparison<a class="headerlink" href="#query-python-versus-pandas-syntax-comparison" title="Permalink to this headline">¶</a></h2>
<p>Full numpy-like syntax</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>

<span class="gp">In [37]: </span><span class="n">df</span>
<span class="gh">Out[37]: </span><span class="go"></span>
<span class="go">    a  b  c</span>
<span class="go">0   0  8  9</span>
<span class="go">1   3  3  9</span>
<span class="go">2   4  1  6</span>
<span class="go">3   6  9  4</span>
<span class="go">.. .. .. ..</span>
<span class="go">6   0  9  3</span>
<span class="go">7   5  4  2</span>
<span class="go">8   6  3  3</span>
<span class="go">9   4  5  6</span>

<span class="go">[10 rows x 3 columns]</span>

<span class="gp">In [38]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(a &lt; b) &amp; (b &lt; c)&#39;</span><span class="p">)</span>
<span class="gh">Out[38]: </span><span class="go"></span>
<span class="go">   a  b  c</span>
<span class="go">0  0  8  9</span>
<span class="go">9  4  5  6</span>

<span class="gp">In [39]: </span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="p">)]</span>
<span class="gh">Out[39]: </span><span class="go"></span>
<span class="go">   a  b  c</span>
<span class="go">0  0  8  9</span>
<span class="go">9  4  5  6</span>
</pre></div>
</div>
<p>Slightly nicer by removing the parentheses (by binding making comparison
operators bind tighter than <code class="docutils literal"><span class="pre">&amp;</span></code>/<code class="docutils literal"><span class="pre">|</span></code>)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [40]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b &amp; b &lt; c&#39;</span><span class="p">)</span>
<span class="gh">Out[40]: </span><span class="go"></span>
<span class="go">   a  b  c</span>
<span class="go">0  0  8  9</span>
<span class="go">9  4  5  6</span>
</pre></div>
</div>
<p>Use English instead of symbols</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [41]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b and b &lt; c&#39;</span><span class="p">)</span>
<span class="gh">Out[41]: </span><span class="go"></span>
<span class="go">   a  b  c</span>
<span class="go">0  0  8  9</span>
<span class="go">9  4  5  6</span>
</pre></div>
</div>
<p>Pretty close to how you might write it on paper</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b &lt; c&#39;</span><span class="p">)</span>
<span class="gh">Out[42]: </span><span class="go"></span>
<span class="go">   a  b  c</span>
<span class="go">0  0  8  9</span>
<span class="go">9  4  5  6</span>
</pre></div>
</div>
</div>
<div class="section" id="the-in-and-not-in-operators">
<h2>7.14.4. The <code class="docutils literal"><span class="pre">in</span></code> and <code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code> operators<a class="headerlink" href="#the-in-and-not-in-operators" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> also supports special use of Python&#8217;s <code class="docutils literal"><span class="pre">in</span></code> and
<code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code> comparison operators, providing a succinct syntax for calling the
<code class="docutils literal"><span class="pre">isin</span></code> method of a <code class="docutils literal"><span class="pre">Series</span></code> or <code class="docutils literal"><span class="pre">DataFrame</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="go"># get all rows where columns &quot;a&quot; and &quot;b&quot; have overlapping values</span>
<span class="gp">In [43]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;aabbccddeeff&#39;</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;aaaabbbbcccc&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                   <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
<span class="gp">   ....: </span>                   <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)})</span>
<span class="gp">   ....: </span>

<span class="gp">In [44]: </span><span class="n">df</span>
<span class="gh">Out[44]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">0   a  a  3  1</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">.. .. .. .. ..</span>
<span class="go">8   e  c  1  0</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go">[12 rows x 4 columns]</span>

<span class="gp">In [45]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b&#39;</span><span class="p">)</span>
<span class="gh">Out[45]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">0  a  a  3  1</span>
<span class="go">1  a  a  0  3</span>
<span class="go">2  b  a  3  4</span>
<span class="go">3  b  a  0  3</span>
<span class="go">4  c  b  4  0</span>
<span class="go">5  c  b  4  7</span>

<span class="go"># How you&#39;d do it in pure Python</span>
<span class="gp">In [46]: </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)]</span>
<span class="gh">Out[46]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">0  a  a  3  1</span>
<span class="go">1  a  a  0  3</span>
<span class="go">2  b  a  3  4</span>
<span class="go">3  b  a  0  3</span>
<span class="go">4  c  b  4  0</span>
<span class="go">5  c  b  4  7</span>

<span class="gp">In [47]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a not in b&#39;</span><span class="p">)</span>
<span class="gh">Out[47]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">6   d  b  3  1</span>
<span class="go">7   d  b  1  2</span>
<span class="go">8   e  c  1  0</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go"># pure Python</span>
<span class="gp">In [48]: </span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)]</span>
<span class="gh">Out[48]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">6   d  b  3  1</span>
<span class="go">7   d  b  1  2</span>
<span class="go">8   e  c  1  0</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>
</pre></div>
</div>
<p>You can combine this with other expressions for very succinct queries:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="go"># rows where cols a and b have overlapping values and col c&#39;s values are less than col d&#39;s</span>
<span class="gp">In [49]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b and c &lt; d&#39;</span><span class="p">)</span>
<span class="gh">Out[49]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">1  a  a  0  3</span>
<span class="go">2  b  a  3  4</span>
<span class="go">3  b  a  0  3</span>
<span class="go">5  c  b  4  7</span>

<span class="go"># pure Python</span>
<span class="gp">In [50]: </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">c</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">d</span><span class="p">)]</span>
<span class="gh">Out[50]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">5   c  b  4  7</span>
<span class="go">7   d  b  1  2</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note that <code class="docutils literal"><span class="pre">in</span></code> and <code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code> are evaluated in Python, since <code class="docutils literal"><span class="pre">numexpr</span></code>
has no equivalent of this operation. However, <strong>only the</strong> <code class="docutils literal"><span class="pre">in</span></code>/<code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code>
<strong>expression itself</strong> is evaluated in vanilla Python. For example, in the
expression</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b + c + d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last"><code class="docutils literal"><span class="pre">(b</span> <span class="pre">+</span> <span class="pre">c</span> <span class="pre">+</span> <span class="pre">d)</span></code> is evaluated by <code class="docutils literal"><span class="pre">numexpr</span></code> and <em>then</em> the <code class="docutils literal"><span class="pre">in</span></code>
operation is evaluated in plain Python. In general, any operations that can
be evaluated using <code class="docutils literal"><span class="pre">numexpr</span></code> will be.</p>
</div>
</div>
<div class="section" id="special-use-of-the-operator-with-list-objects">
<h2>7.14.5. Special use of the <code class="docutils literal"><span class="pre">==</span></code> operator with <code class="docutils literal"><span class="pre">list</span></code> objects<a class="headerlink" href="#special-use-of-the-operator-with-list-objects" title="Permalink to this headline">¶</a></h2>
<p>Comparing a <code class="docutils literal"><span class="pre">list</span></code> of values to a column using <code class="docutils literal"><span class="pre">==</span></code>/<code class="docutils literal"><span class="pre">!=</span></code> works similarly
to <code class="docutils literal"><span class="pre">in</span></code>/<code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code></p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;b == [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#39;</span><span class="p">)</span>
<span class="gh">Out[51]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">0   a  a  3  1</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">.. .. .. .. ..</span>
<span class="go">8   e  c  1  0</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go">[12 rows x 4 columns]</span>

<span class="go"># pure Python</span>
<span class="gp">In [52]: </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])]</span>
<span class="gh">Out[52]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">0   a  a  3  1</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">.. .. .. .. ..</span>
<span class="go">8   e  c  1  0</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go">[12 rows x 4 columns]</span>

<span class="gp">In [53]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;c == [1, 2]&#39;</span><span class="p">)</span>
<span class="gh">Out[53]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">7  d  b  1  2</span>
<span class="go">8  e  c  1  0</span>

<span class="gp">In [54]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;c != [1, 2]&#39;</span><span class="p">)</span>
<span class="gh">Out[54]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">0   a  a  3  1</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">.. .. .. .. ..</span>
<span class="go">6   d  b  3  1</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go">[10 rows x 4 columns]</span>

<span class="go"># using in/not in</span>
<span class="gp">In [55]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;[1, 2] in c&#39;</span><span class="p">)</span>
<span class="gh">Out[55]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">7  d  b  1  2</span>
<span class="go">8  e  c  1  0</span>

<span class="gp">In [56]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;[1, 2] not in c&#39;</span><span class="p">)</span>
<span class="gh">Out[56]: </span><span class="go"></span>
<span class="go">    a  b  c  d</span>
<span class="go">0   a  a  3  1</span>
<span class="go">1   a  a  0  3</span>
<span class="go">2   b  a  3  4</span>
<span class="go">3   b  a  0  3</span>
<span class="go">.. .. .. .. ..</span>
<span class="go">6   d  b  3  1</span>
<span class="go">9   e  c  4  7</span>
<span class="go">10  f  c  0  1</span>
<span class="go">11  f  c  0  0</span>

<span class="go">[10 rows x 4 columns]</span>

<span class="go"># pure Python</span>
<span class="gp">In [57]: </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
<span class="gh">Out[57]: </span><span class="go"></span>
<span class="go">   a  b  c  d</span>
<span class="go">7  d  b  1  2</span>
<span class="go">8  e  c  1  0</span>
</pre></div>
</div>
</div>
<div class="section" id="boolean-operators">
<h2>7.14.6. Boolean Operators<a class="headerlink" href="#boolean-operators" title="Permalink to this headline">¶</a></h2>
<p>You can negate boolean expressions with the word <code class="docutils literal"><span class="pre">not</span></code> or the <code class="docutils literal"><span class="pre">~</span></code> operator.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [58]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>

<span class="gp">In [59]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;bools&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.5</span>

<span class="gp">In [60]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;~bools&#39;</span><span class="p">)</span>
<span class="gh">Out[60]: </span><span class="go"></span>
<span class="go">        a       b       c  bools</span>
<span class="go">4  0.9722  0.6328  0.7278  False</span>
<span class="go">7  0.9512  0.4674  0.4987  False</span>

<span class="gp">In [61]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;not bools&#39;</span><span class="p">)</span>
<span class="gh">Out[61]: </span><span class="go"></span>
<span class="go">        a       b       c  bools</span>
<span class="go">4  0.9722  0.6328  0.7278  False</span>
<span class="go">7  0.9512  0.4674  0.4987  False</span>

<span class="gp">In [62]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;not bools&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">bools</span><span class="p">]</span>
<span class="gh">Out[62]: </span><span class="go"></span>
<span class="go">      a     b     c bools</span>
<span class="go">4  True  True  True  True</span>
<span class="go">7  True  True  True  True</span>
</pre></div>
</div>
<p>Of course, expressions can be arbitrarily complex too</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="go"># short query syntax</span>
<span class="gp">In [63]: </span><span class="n">shorter</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b &lt; c and (not bools) or bools &gt; 2&#39;</span><span class="p">)</span>

<span class="go"># equivalent in pure Python</span>
<span class="gp">In [64]: </span><span class="n">longer</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">bools</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">bools</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)]</span>

<span class="gp">In [65]: </span><span class="n">shorter</span>
<span class="gh">Out[65]: </span><span class="go"></span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [a, b, c, bools]</span>
<span class="go">Index: []</span>

<span class="gp">In [66]: </span><span class="n">longer</span>
<span class="gh">Out[66]: </span><span class="go"></span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [a, b, c, bools]</span>
<span class="go">Index: []</span>

<span class="gp">In [67]: </span><span class="n">shorter</span> <span class="o">==</span> <span class="n">longer</span>
<span class="gh">Out[67]: </span><span class="go"></span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [a, b, c, bools]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
</div>
<div class="section" id="performance-of-query">
<h2>7.14.7. Performance of <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code><a class="headerlink" href="#performance-of-query" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">DataFrame.query()</span></code> using <code class="docutils literal"><span class="pre">numexpr</span></code> is slightly faster than Python for
large frames</p>
<img alt="../_images/query-perf.png" src="../_images/query-perf.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You will only see the performance benefits of using the <code class="docutils literal"><span class="pre">numexpr</span></code> engine
with <code class="docutils literal"><span class="pre">DataFrame.query()</span></code> if your frame has more than approximately 200,000
rows</p>
<blockquote class="last">
<div><img alt="../_images/query-perf-small.png" src="../_images/query-perf-small.png" />
</div></blockquote>
</div>
<p>This plot was created using a <code class="docutils literal"><span class="pre">DataFrame</span></code> with 3 columns each containing
floating point values generated using <code class="docutils literal"><span class="pre">numpy.random.randn()</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="indexing15.html" class="btn btn-neutral float-right" title="7.15. Duplicate Data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="indexing13.html" class="btn btn-neutral" title="7.13. The where() Method and Masking" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>